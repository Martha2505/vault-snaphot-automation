name: Vault Snapshot Upload

on:
  workflow_dispatch: # you can trigger manually

jobs:
  snapshot-and-upload:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout (not strictly needed unless you use repo files)
        uses: actions/checkout@v3

      - name: Set timestamp
        id: timestamp
        run: echo "value=$(date +%Y%m%d%H%M%S)" >> $GITHUB_OUTPUT

      - name: Download Vault snapshot
        run: |
          curl --header "X-Vault-Token: ${{ secrets.VAULT_TOKEN }}" \
               https://your-vault-address/v1/sys/storage/raft/snapshot \
               --output snapshot.snap

      - name: Upload snapshot to Azure Blob using Azure CLI
        run: |
          az storage blob upload \
            --account-name ${{ secrets.AZURE_STORAGE_ACCOUNT }} \
            --container-name ${{ secrets.AZURE_BLOB_CONTAINER }} \
            --name snapshot-${{ steps.timestamp.outputs.value }}.snap \
            --file snapshot.snap \
            --sas-token "${{ secrets.AZURE_SAS_TOKEN }}"
