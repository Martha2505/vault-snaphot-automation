name: Upload Vault Snapshot to Azure Blob

on:
  workflow_dispatch:

jobs:
  upload:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Install Azure CLI
      uses: azure/setup-azure@v1

    - name: Login to Azure with Service Principal
      run: |
        az login --service-principal \
          --username "$AZURE_CLIENT_ID" \
          --password "$AZURE_CLIENT_SECRET" \
          --tenant "$AZURE_TENANT_ID"

    - name: Create dummy vault snapshot
      run: |
        echo "Vault snapshot at $(date)" > vault.snap

    - name: Upload to Azure Blob Storage
      run: |
        az storage blob upload \
          --account-name "$AZURE_STORAGE_ACCOUNT" \
          --container-name "$AZURE_CONTAINER_NAME" \
          --name vault-$(date +%Y%m%d%H%M).snap \
          --file vault.snap \
          --auth-mode login
